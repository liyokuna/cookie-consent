dist: trusty
sudo: false
language: node_js
node_js:
- 10.9.0
addons:
  chrome: stable
cache:
  directories:
  - "./node_modules"
install:
- npm install
jobs:
  include:
  - stage: Test Library
    script:
    - npm run test cookie-service -- --no-watch --no-progress --browsers=ChromeHeadless
  - stage: Npm Release
    node_js: 10.9.0
    script:
    - echo "Deployig to NPM..."
    - npm run build-lib
    - npm run copy-readme
    before_deploy:
    - cd dist/cookie-service
    deploy:
      provider: npm
      skip_cleanup: true
      email: owner_mail
      api_key:
        secure: NPM_AUTH_TOKEN
      local_dir: dist/cookie-service
      on:
        tags: true
        all_branches: true
  - stage: Deploy docs
    node_js: 10.9.0
    script:
    - echo "Deploying to gh Page..."
    - npm run build-docs
    deploy:
      provider: pages
      skip_cleanup: true
      github_token: "$GITHUB_TOKEN"
      keep_history: true
      local_dir: dist/cookie-consent
      fqdn: cookie-consent.org
      on:
        tags: true
        branch: master
deploy:
  api_key:
    secure: LNXXhZYni9dWmNOEaf/O5/tTGOpRw/5QQiJkKxSkc+sgWDxw8bZf9hRG//b/v6dK9mgwr8mIqMFDkzTOGEsVb5A9dQRPBkDDmAAKg4sIrmmSgkG0U5pzYhCFbC6j4YcsJ1xAKl7MDfKC4/OF6Kpm0YSK3mcLinZKz8s7jNeFRpAcBFQpuk3kUKaEv21QnauXy6VhOs8a/eAfUz2HZBhtRnxVDuIcKsyU6k8N42MS85APb7zG7FUcuUfeFalyyySeptf0s2F9Bn8y4MUqI3kUwI6PPRz0fBdClxx/Y9WblT2sspMapcB6ocE/5kfacMHW5i6CF6G/a+509K2rqVbZXDGr+wNX+3x/ujYaHdBcV4DWaKHZPl+lO3ZOt6KhZeOeYBvHyZFscOthu+WF7cCPlBQpc2fpbjuqU3hsDk1buUgHO/lUPVcwFOcj3KX8lnHWYCCqV8z9MP0N2wcBrwSsFgKw5pW2EDpFfvSNg/I/ifb4EEv354eZeMWqCX1XQ0/HLXres0HEfirqd75oDHeEzfOTf8Q+le+Th9CzZpI6Erzswu+i7fzPmfdWeqabYUdiePjwbqZr3wK9r3Sy5bg/dcaZGTTizXISgxVri4iCP7N38gXClvFuTHjmZWpazAi/6QZBHpIEjFeZVogHL9TBVtMj6tuOTy8D/Gtp0k4fiAU=
